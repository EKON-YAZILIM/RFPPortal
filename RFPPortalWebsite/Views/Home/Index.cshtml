@{
    ViewData["Title"] = "RFP Portal";
}

@model List<RFPPortalWebsite.Models.DbModels.Rfp>

<section>
    <div class="container mt-3">
        <div class="h1 text-center text-dark mb-4 p-4" id="pageHeaderTitle">Request For Proposals</div>
        <hr />
        <input placeholder="Search by title or description" class="form-control mb-4 p-4" />

        @try
        {
            foreach (var item in Model)
            {
                string biddingType = "";
                string remainingTime = "";
                if (item.CreateDate.AddDays(Program._settings.InternalBiddingDays) >= DateTime.Now)
                {
                    biddingType = "Internal Bidding";
                    remainingTime = (item.CreateDate.AddDays(Program._settings.InternalBiddingDays) - DateTime.Now).Days + " days remaining";
                }
                else if (DateTime.Now >= item.CreateDate.AddDays(Program._settings.InternalBiddingDays) &&
                         DateTime.Now <= item.CreateDate.AddDays(Program._settings.InternalBiddingDays + Program._settings.PublicBiddingDays))
                {
                    biddingType = "Public Bidding";
                    remainingTime = (item.CreateDate.AddDays(Program._settings.InternalBiddingDays + Program._settings.PublicBiddingDays) - DateTime.Now).Days + " days remaining";
                }
                else
                {
                    biddingType = "Bidding Ended";
                }

                string clr = "";
                if (item.Status.ToLower() == "active")
                {
                    clr = "green";
                }
                else
                {
                    clr = "blue";
                }


                <article class="postcard light cursor-pointer @clr">
                    <a class="postcard__img_link" href="./RFP-Detail/@item.RfpID">
                        <img class="postcard__img" src="~/images/casper.png" alt="Image Title" />
                    </a>
                    <div class="postcard__text t-dark" onclick="window.location.href='./RFP-Detail/'+@item.RfpID">
                        <h1 class="postcard__title @clr"><a onclick="window.location.href='./RFP-Detail/'+@item.RfpID">Podcast Title</a></h1>
                        <div class="postcard__subtitle small">
                            <time datetime="@item.CreateDate">
                                <i class="fas fa-calendar-alt mr-2"></i>Posted at: @item.CreateDate.ToLocalTime().ToString("MM/dd/yyyy")
                            </time>
                        </div>
                        <div class="postcard__bar"></div>
                        <div class="postcard__preview-txt">
                            @if (@item.Description.Length > 50)
                            {
                                @item.Description.Substring(0, Math.Min(item.Description.Length, 50)) <span>..</span>
                            }
                            else
                            {
                                @item.Description
                            }
                        </div>
                        <ul class="postcard__tagbox">
                            <li class="tag__item"><i class="fas fa-circle mr-2 dot_@clr" title="Status"></i>@item.Status</li>
                            @if (item.Status == RFPPortalWebsite.Models.Constants.Enums.RfpStatusTypes.Active.ToString())
                            {
                                <li class="tag__item"><i class="fas fa-clock mr-2" title="Time Remaining"></i>@remainingTime</li>
                                <li class="tag__item play"><i class="fas fa-play mr-2"></i> @biddingType</li>
                            }
                            else
                            {
                                <li class="tag__item play"><i class="fas fa-stop mr-2"></i> @biddingType</li>
                            }
                        </ul>
                    </div>
                </article>

            }
        }
        catch { }


    </div>
</section>